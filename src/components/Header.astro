---
// src/components/Header.astro
import LangSwitcher from "./LangSwitcher.astro";

const { locale, currentPath } = Astro.props;

// Navegaci√≥n por idioma
const nav = {
  es: [
    ["/es", "Inicio"],
    ["/es/nosotros", "Nosotros"],
    ["/es/tratamientos", "Tratamientos"],
    ["/es/blog", "Blog"],
  ],
  ca: [
    ["/ca", "Inici"],
    ["/ca/nosotros", "Nosaltres"],
    ["/ca/tratamientos", "Tractaments"],
    ["/ca/blog", "Blog"],
  ],
  en: [
    ["/en", "Home"],
    ["/en/nosotros", "About"],
    ["/en/tratamientos", "Treatments"],
    ["/en/blog", "Blog"],
  ],
}[locale];

// Textos din√°micos
const texts = {
  es: {
    address: "C. de Muntaner 555, Sarri√†-Sant Gervasi, Barcelona",
    phoneLabel: "Tel√©fono",
    bookCta: "PEDIR CITA",
    ariaLang: "Idioma",
  },
  ca: {
    address: "C. de Muntaner 555, Sarri√†-Sant Gervasi, Barcelona",
    phoneLabel: "Tel√®fon",
    bookCta: "DEMANA CITA",
    ariaLang: "Idioma",
  },
  en: {
    address: "C. de Muntaner 555, Sarri√†-Sant Gervasi, Barcelona",
    phoneLabel: "Phone",
    bookCta: "BOOK NOW",
    ariaLang: "Language",
  },
}[locale];
---

<header class="site-header">
  <!-- TOPBAR -->
  <div class="topbar">
    <div class="container topbar__inner">
      <div class="contact">
        <span class="addr">{texts.address}</span>
        <span class="sep">|</span>
        <span class="tel">
          {texts.phoneLabel}:
          <span class="telnum">+34 614 37 57 92</span>
        </span>
      </div>

      <nav class="langs" aria-label={texts.ariaLang}>
        <LangSwitcher {currentPath} {locale} />
      </nav>
    </div>
  </div>

  <!-- MAINBAR -->
  <div class="mainbar">
    <div class="container mainbar__inner">
      <a href={nav[0][0]} class="logo" aria-label="Dental Sueca">
        <img src="/assets/logo.svg" alt="Dental Sueca" />
      </a>

      <!-- Men√∫ principal -->
      <nav id="site-nav" class="nav" aria-label="Principal">
        {nav.map(([href, label]) => <a href={href}>{label}</a>)}
      </nav>

      <!-- Bot√≥n hamburguesa (solo m√≥vil) -->
      <button
        class="hamburger"
        aria-label="Abrir men√∫"
        aria-controls="site-nav"
        aria-expanded="false"
      >
        <svg viewBox="0 0 24 24" width="26" height="26" aria-hidden="true">
          <path d="M3 6h18M3 12h18M3 18h18"
                stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>

      <!-- CTA (oculto en m√≥vil v√≠a CSS) -->
      <a class="cta" href={`${nav[0][0]}/cita`}>{texts.bookCta}</a>
    </div>
  </div>

  <!-- Overlay -->
  <div class="nav-overlay" hidden></div>
</header>

<!-- Script de interacci√≥n -->
<script is:inline>
  (function () {
    const header = document.querySelector('.site-header');
    const btn = header?.querySelector('.hamburger');
    const nav = header?.querySelector('#site-nav');
    const overlay = header?.querySelector('.nav-overlay');
    if (!btn || !nav || !overlay) return;

    function open() {
      header.classList.add('is-open');
      btn.setAttribute('aria-expanded', 'true');
      overlay.hidden = false;
      document.documentElement.classList.add('no-scroll-x');
    }
    function close() {
      header.classList.remove('is-open');
      btn.setAttribute('aria-expanded', 'false');
      overlay.hidden = true;
      document.documentElement.classList.remove('no-scroll-x');
    }

    btn.addEventListener('click', () => {
      header.classList.contains('is-open') ? close() : open();
    });
    overlay.addEventListener('click', close);
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') close(); });
  })();
</script>

<!-- Estilos globales -->
<style is:global>
  /* ====== Salvaguardas generales ====== */
  html.no-scroll-x, html.no-scroll-x body { overflow-x: hidden; }

  .hamburger{
    display: none;
    background: transparent;
    border: 0;
    padding: 8px;
    line-height: 0;
    cursor: pointer;
    color: #1b2a3a;
  }
  .nav-overlay{
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.28);
    z-index: 998;
  }
  .site-header.is-open .nav-overlay{ display: block; }

  /* ====== M√≥vil ‚â§640px ====== */
  @media (max-width: 640px){
    /* üîí Bloqueo de desplazamiento horizontal y gestos laterales */
    html, body {
      overflow-x: hidden;       /* no hay scroll horizontal */
      width: 100%;
      overscroll-behavior-x: none; /* sin ‚Äúrebote‚Äù lateral */
      touch-action: pan-y;      /* solo desplazar vertical (bloquea pan-x) */
    }

    /* Elementos que suelen causar overflow: que no puedan exceder el viewport */
    img, svg, video, iframe {
      max-width: 100%;
      height: auto;
    }

    /* Hamburguesa visible */
    .hamburger{ display:inline-flex; align-items:center; justify-content:center; }

    .mainbar__inner{
      height:64px;
      gap:10px;
      overflow: hidden; /* red de seguridad ante 1-2px ‚Äúfugitivos‚Äù */
      justify-content: space-between;
    }

    .logo{ margin-right:0; flex:0 0 auto; }
    .logo img{ height:32px; }

    /* NAV como panel lateral */
    #site-nav{
      position:fixed;
      top:0; right:0;
      height:100dvh;
      width:min(78vw,360px);
      display:flex; flex-direction:column;
      gap:12px;
      padding:80px 20px 20px;
      background:#fff;
      border-left:1px solid #eef3f8;
      box-shadow:-12px 0 30px rgba(0,0,0,.12);
      transform:translateX(100%);
      transition:transform .24s ease;
      z-index:999;
      overflow-y:auto;
    }
    #site-nav > a{
      font-size:18px;
      padding:10px 2px;
      text-decoration:none;
      color:#1f2f46;
      border-bottom:1px solid #f1f4f8;
    }
    #site-nav > a:last-child{ border-bottom:0; }
    .site-header.is-open #site-nav{ transform:translateX(0%); }

    /* Topbar flexible */
    .topbar__inner{
      height:auto; flex-wrap:wrap; gap:6px; padding:6px 0;
    }
    .contact{
      white-space:normal; overflow-wrap:anywhere;
      line-height:1.25; font-size:13px;
    }
    .contact .sep{ display:none; }

    /* La nav horizontal no debe empujar */
    .nav{ margin-left:0; margin-right:0; gap:0; }

    /* üí° Espacio lateral m√≠nimo en la mainbar para evitar ‚Äúpixel fantasma‚Äù */
    .mainbar .container { padding-left: 12px; padding-right: 12px; }

    /* üö´ CTA oculto en m√≥vil (como pediste) */
    .cta{ display: none !important; }
  }

  /* Ajuste extra para m√≥viles muy angostos (‚â§360 px) ‚Äî opcional
     Mantiene la protecci√≥n anti-overflow si por alguna raz√≥n se forzara el CTA. */
  @media (max-width: 360px){
    .cta{
      display: none !important;
      max-width: 42vw;
      font-size: 12.5px;
      padding: 6px 10px;
      letter-spacing: .1px;
    }
  }
</style>
