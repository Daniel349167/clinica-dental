---
import LangSwitcher from "./LangSwitcher.astro";

const { locale, currentPath } = Astro.props;

// Navegación por idioma
const nav = {
  es: [
    ["/es", "Inicio"],
    ["/es/nosotros", "Nosotros"],
    ["/es/tratamientos", "Tratamientos"],
    ["/es/blog", "Blog"],
  ],
  ca: [
    ["/ca", "Inici"],
    ["/ca/nosotros", "Nosaltres"],
    ["/ca/tratamientos", "Tractaments"],
    ["/ca/blog", "Blog"],
  ],
  en: [
    ["/en", "Home"],
    ["/en/nosotros", "About"],
    ["/en/tratamientos", "Treatments"],
    ["/en/blog", "Blog"],
  ],
}[locale];

// Textos dinámicos
const texts = {
  es: {
    address: "C. de Muntaner 555, Sarrià-Sant Gervasi, Barcelona",
    phoneLabel: "Teléfono",
    bookCta: "PEDIR CITA",
    ariaLang: "Idioma",
  },
  ca: {
    address: "C. de Muntaner 555, Sarrià-Sant Gervasi, Barcelona",
    phoneLabel: "Telèfon",
    bookCta: "DEMANA CITA",
    ariaLang: "Idioma",
  },
  en: {
    address: "C. de Muntaner 555, Sarrià-Sant Gervasi, Barcelona",
    phoneLabel: "Phone",
    bookCta: "BOOK NOW",
    ariaLang: "Language",
  },
}[locale];
---

<header class="site-header">
  <!-- TOPBAR -->
  <div class="topbar">
    <div class="container topbar__inner">
      <div class="contact">
        <!-- Dirección (se oculta en móvil por CSS) -->
        <span class="addr">{texts.address}</span>
        <span class="sep">|</span>

        <!-- Teléfono: en móvil ocultamos la etiqueta y mostramos icono + número -->
        <span class="tel">
          <span class="tel-label">{texts.phoneLabel}:</span>
          <span class="telnum">
            <a class="tel-link" href="tel:+34614375792">+34 614 37 57 92</a>
          </span>
        </span>
      </div>

      <nav class="langs" aria-label={texts.ariaLang}>
        <LangSwitcher {currentPath} {locale} />
      </nav>
    </div>
  </div>

  <!-- MAINBAR -->
  <div class="mainbar">
    <div class="container mainbar__inner">
      <a href={nav[0][0]} class="logo" aria-label="Dental Sueca">
        <img src="/assets/logo.svg" alt="Dental Sueca" />
      </a>

      <!-- Menú principal -->
      <nav id="site-nav" class="nav" aria-label="Principal">
        {nav.map(([href, label]) => <a href={href}>{label}</a>)}
      </nav>

      <!-- Botón hamburguesa (solo móvil) -->
      <button
        class="hamburger"
        aria-label="Abrir menú"
        aria-controls="site-nav"
        aria-expanded="false"
      >
        <svg viewBox="0 0 24 24" width="26" height="26" aria-hidden="true">
          <path d="M3 6h18M3 12h18M3 18h18"
                stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>

      <!-- CTA (oculto en móvil vía CSS) -->
      <a class="cta" href={`${nav[0][0]}/cita`}>{texts.bookCta}</a>
    </div>
  </div>

  <!-- Overlay -->
  <div class="nav-overlay" hidden></div>
</header>

<!-- Script de interacción -->
<script is:inline>
  (function () {
    const header = document.querySelector('.site-header');
    const btn = header?.querySelector('.hamburger');
    const nav = header?.querySelector('#site-nav');
    const overlay = header?.querySelector('.nav-overlay');
    if (!btn || !nav || !overlay) return;

    function open() {
      header.classList.add('is-open');
      btn.setAttribute('aria-expanded', 'true');
      overlay.hidden = false;
      document.documentElement.classList.add('no-scroll-x');
    }
    function close() {
      header.classList.remove('is-open');
      btn.setAttribute('aria-expanded', 'false');
      overlay.hidden = true;
      document.documentElement.classList.remove('no-scroll-x');
    }

    btn.addEventListener('click', () => {
      header.classList.contains('is-open') ? close() : open();
    });
    overlay.addEventListener('click', close);
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') close(); });
  })();
</script>

<!-- Estilos globales -->
<style is:global>
/* ===== Topbar (desktop base) ===== */
.topbar{
  background:#f1f2f3;
  color:var(--text-600);
  font-size:14px;
}
.topbar__inner{
  height:44px;
  display:flex; align-items:center; justify-content:space-between;
}
.contact{
  display:flex;
  align-items:baseline;      /* desktop */
  gap:10px;
  white-space:nowrap;
  line-height:1.1;
}
.topbar .contact .telnum { text-decoration:none !important; color:inherit; cursor:default; }
.topbar .contact .telnum:hover { text-decoration:none; }
.contact span{ display:inline-block; }
.contact .sep{ color:#90a2b5; }
.contact .tel{ font-size:14px; }
.contact .telnum{ font-weight:400; color:#2d4a67; }

/* ===== Mainbar (desktop base) ===== */
.mainbar{
  background:#fff;
  border-bottom:1px solid #eef3f8;
}
.mainbar__inner{
  height:84px;
  display:flex; align-items:center;
  gap:24px;
}
.logo{ display:inline-flex; align-items:center; text-decoration:none; margin-right:96px; }
.logo img{ height:40px; width:auto; display:block; margin-left:20px; }

.nav{
  display:flex; align-items:center;
  gap:44px;
  margin-left:auto;
  margin-right:48px;
}
.nav > a,
.nav > a:link,
.nav > a:visited{
  color:#3a3a3a;
  text-decoration:none;
  font-size:20px;
  font-weight:400;
}
.nav > a:hover{ color:var(--brand-500); }

.cta,
.cta:link,
.cta:visited{
  display:inline-block;
  background:var(--brand-500);
  color:#fff;
  text-decoration:none;
  font-weight:700;
  text-transform:uppercase;
  letter-spacing:.3px;
  font-size:18px;
  padding:9px 28px;
  border-radius:8px;
  line-height:1;
  transition:filter .15s ease-in-out, transform .06s ease-in-out;
}
.cta:active{ transform:translateY(1px); }

.hamburger{
  display:none;
  background:transparent;
  border:0;
  padding:8px;
  line-height:0;
  cursor:pointer;
  color:#1b2a3a;
}
.nav-overlay{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.28);
  z-index:998;
}
.site-header.is-open .nav-overlay{ display:block; }

/* Enlaces del teléfono cuando son tocables */
.topbar .tel-link{ text-decoration:none; color:inherit; }
.topbar .tel-link:hover{ text-decoration:none; }

/* ====== Móvil ≤640px ====== */
/* ====== Móvil ≤640px (versión consolidada) ====== */
@media (max-width: 640px){

  /* ---------- MAINBAR (logo + hamburguesa) ---------- */
  .mainbar__inner{
    height:56px;
    gap:8px;
    overflow:hidden;
    justify-content:space-between;
  }
  .logo{ margin-right:0; flex:0 0 auto; }
  .logo img{ height:28px; margin-left:0; transform:translateX(-3px); }
  .hamburger{ display:inline-flex; align-items:center; justify-content:center; padding:6px; }

  /* ---------- NAV como drawer lateral ---------- */
  #site-nav{
    position:fixed;
    top:0; right:0;
    height:100dvh;
    width:min(78vw,360px);
    display:flex; flex-direction:column;
    gap:12px;
    padding:80px 20px 20px;
    background:#fff;
    border-left:1px solid #eef3f8;
    box-shadow:-12px 0 30px rgba(0,0,0,.12);
    transform:translateX(100%);
    transition:transform .24s ease;
    z-index:999;
    overflow-y:auto;
  }
  #site-nav > a{
    font-size:18px;
    padding:10px 2px;
    text-decoration:none;
    color:#1f2f46;
    border-bottom:1px solid #f1f4f8;
  }
  #site-nav > a:last-child{ border-bottom:0; }
  .site-header.is-open #site-nav{ transform:translateX(0%); }

  /* ---------- TOPBAR (teléfono izq. + idiomas der.) ---------- */
  /* Ocultar dirección, separador y etiqueta "Teléfono:" en móvil */
  .topbar .addr,
  .topbar .sep,
  .topbar .tel-label{ display:none !important; }

  .topbar__inner{
    height:42px;
    display:flex;
    flex-direction:row;
    align-items:center;
    justify-content:flex-start;   /* contacto a la izq. */
    gap:12px;
    padding:6px 12px;
    flex-wrap:nowrap;             /* evita salto de fila */
  }

  /* Contacto (teléfono) SIEMPRE a la izquierda */
  .topbar .contact{
    order:0;
    margin-right:0;
    display:inline-flex;
    align-items:center;
    gap:8px;
    white-space:nowrap;
    line-height:1;
    font-size:14px;
  }

  /* Idiomas empujados a la derecha y más pequeños */
  .topbar .langs{
    order:10;
    margin-left:auto;
    transform:translateY(0);
  }
  .topbar .langs a{
    font-size:12px;       /* ↓ más chico */
    line-height:1;
  }

  /* Teléfono: número un poco más chico y el icono un pelín más arriba */
  .topbar .telnum{
    display:inline-flex;
    align-items:flex-end; /* baja el texto respecto al alto del icono */
    gap:6px;
    font-weight:600;
    font-size:13px;       /* ↓ más chico */
    color:var(--text-900, #0b1b2a);
    line-height:1;
    transform:translateY(1px); /* baja visualmente el bloque del número */
  }
  

  /* Nav horizontal (desktop) no debe afectar en móvil */
  .nav{ margin-left:0; margin-right:0; gap:0; }

  /* Lateral del mainbar */
  .mainbar .container{ padding-left:8px; padding-right:12px; }

  /* CTA oculta en móvil */
  .cta{ display:none !important; }
}

@media (max-width: 640px){
.topbar .telnum::before{
    content:"";
    width:14px; height:14px; display:inline-block;
    background:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%230f2741' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='M22 16.92v3a2 2 0 0 1-2.18 2A19 19 0 0 1 3.09 5.18 2 2 0 0 1 5 3h3a2 2 0 0 1 2 1.72c.12 .86 .33 1.7 .62 2.5a2 2 0 0 1-.45 2.11L9 10a16 16 0 0 0 5 5l.67-1.17a2 2 0 0 1 2.11-.45c.8 .29 1.64 .5 2.5 .62A2 2 0 0 1 22 16.92z'/></svg>")
              center/contain no-repeat;
    transform:translateY(-1px);   /* ↑ sube levemente SOLO el icono */
  }
/* Iconos ligeros en la lista del drawer */
/* ===== Drawer móvil “chivo” (mejoras visuales) ===== */
#site-nav{
  width: 250px;
  padding: 24px 18px;                  /* controlamos padding aquí */
 background:
    radial-gradient(420% 300% at 120% -60%, rgba(0, 0, 0, .07) 0%, rgba(0, 0, 0, 0.03) 60%, transparent 95%),
    linear-gradient(180deg, var(--brand-50, #e9f9ff) 0%, var(--bg, #ffffff) 80%);
  border-left: 1px solid rgba(11,27,42,.06);

}

/* Items del menú con look de “cards” ligeras */
#site-nav > a{
  display: flex; align-items: center; gap: 10px;
  font-size: 18px; font-weight: 600;
  padding: 14px 12px;
  color: var(--text-900, #0b1b2a); text-decoration: none;
  border-radius: 12px; border: 1px solid transparent;
  background: transparent;
  transition: background .2s ease, border-color .2s ease, transform .06s ease;
}
#site-nav > a[href*="/tratamientos"] {
  gap: 7px;
}
#site-nav > a + a{ margin-top: 6px; }
#site-nav > a:hover,
#site-nav > a:focus-visible{
  background: var(--brand-50, #e9f9ff);
  border-color: color-mix(in oklab, var(--brand-500, #00b1ef) 35%, transparent);
  outline: none;
}
#site-nav > a:active{ transform: translateY(1px); }

/* Activo con highlight suave y “dot” a la derecha */
#site-nav > a.is-active{
  background: linear-gradient(180deg, #fff 0%, var(--brand-50, #e9f9ff) 100%);
  border-color: color-mix(in oklab, var(--brand-500, #00b1ef) 45%, transparent);
}
#site-nav > a.is-active::after{
  content:""; margin-left:auto; width:6px; height:6px; border-radius:50%;
  background: var(--brand-500, #00b1ef);
}

/* ===== Iconografía consistente (con tu paleta) ===== */
#site-nav > a{ position: relative; padding-left: 12px; }
#site-nav > a::before{
  content:""; width:20px; height:20px; flex:0 0 20px;
  background-size: contain; background-repeat: no-repeat; background-position: center;
  opacity: .95;
}

/* Home */
/* Home */
#site-nav > a[href$="/es"]::before,
#site-nav > a[href$="/ca"]::before,
#site-nav > a[href$="/en"]::before{
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2337516d' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M3 10l9-7 9 7v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z'/%3E%3Cpath d='M9 22V12h6v10'/%3E%3C/svg%3E");
}

/* Nosotros */
#site-nav > a[href*="/nosotros"]::before{
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2337516d' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='7' r='4'/%3E%3Cpath d='M5.5 21a7 7 0 0 1 13 0'/%3E%3C/svg%3E");
}

/* Tratamientos (nuevo icono — diente con cruz médica, en negro) */
#site-nav > a[href*="/tratamientos"]::before {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%230b1b2a' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 2c3 0 6 2.4 6 6.3 0 5.4-2 11.7-6 11.7S6 13.7 6 8.3C6 4.4 9 2 12 2z'/%3E%3Cpath d='M10.5 9h3M12 7.5v3'/%3E%3C/svg%3E");
}


/* Blog */
#site-nav > a[href*="/blog"]::before{
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2337516d' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='4' y='4' width='16' height='16' rx='2'/%3E%3Cpath d='M8 9h8M8 13h8M8 17h5'/%3E%3C/svg%3E");
}


}
</style>
