---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";

/* URLs espejo: mismo slug en los 3 idiomas (tratamientos) */
const alternates = { es: "/es/tratamientos", ca: "/ca/tratamientos", en: "/en/tratamientos" };
---

<BaseLayout
  description="Conoce todos nuestros tratamientos dentales en Barcelona."
  locale="es"
  {alternates}
>
  <Header locale="es" currentPath="/es/tratamientos" {alternates} />

  <!-- =========================
       HERO TRATAMIENTOS (ES)
       ========================= -->
  <section class="tr-hero" aria-label="Secci√≥n de bienvenida a Tratamientos">
    <div class="tr-hero__bg"></div>

    <div class="tr-hero__inner container">
      <img class="tr-hero__mark" src="/assets/mark-hero.svg" alt="" aria-hidden="true" />
      <h1 class="tr-hero__title">
        El tratamiento que transformar√°<br />
        tu sonrisa est√° aqu√≠
      </h1>
    </div>
  </section>

  <!-- =========================
       TRATAMIENTOS - SEIS TARJETAS
       ========================= -->
  <section class="tr-grid container">
    <div class="tr-grid__cards">
      <!-- 1. ORTODONCIA (ENLACE REAL) -->
      <a class="tr-card" href="/es/tratamientos/ortodoncia" aria-label="Ver tratamientos de Ortodoncia y alineadores">
        <img src="/assets/ortodoncia.svg" alt="" />
        <h3>Ortodoncia y alineadores</h3>
        <p>
          Alineamos tu sonrisa con tratamientos modernos y discretos.
          Desde brackets est√©ticos hasta ortodoncia invisible.
        </p>
      </a>

      <!-- El resto pueden apuntar a su futura URL o temporalmente a '#' -->
      <a class="tr-card" href="/es/tratamientos/implantes" aria-label="Ver tratamientos de Implantes dentales">
        <img src="/assets/implante.svg" alt="" />
        <h3>Implantes dentales</h3>
        <p>
          Recupera la funcionalidad y est√©tica con implantes de √∫ltima generaci√≥n.
          Resultados duraderos y naturales.
        </p>
      </a>

      <a class="tr-card" href="/es/tratamientos/estetica-dental" aria-label="Ver tratamientos de Est√©tica dental">
        <img src="/assets/estetica.svg" alt="" />
        <h3>Est√©tica dental</h3>
        <p>
          Carillas, blanqueamiento y dise√±o de sonrisa para mejorar la armon√≠a y luminosidad de tu rostro.
        </p>
      </a>

      <a class="tr-card" href="/es/tratamientos/rehabilitacion-oral" aria-label="Ver tratamientos de Rehabilitaci√≥n oral">
        <img src="/assets/rehabilitacion.svg" alt="" />
        <h3>Rehabilitaci√≥n oral</h3>
        <p>
          Tratamiento integral que combina pr√≥tesis, implantes y otras t√©cnicas para devolver la funcionalidad.
        </p>
      </a>

      <a class="tr-card" href="/es/tratamientos/endodoncia" aria-label="Ver tratamientos de Endodoncia">
        <img src="/assets/endodoncia.svg" alt="" />
        <h3>Endodoncia</h3>
        <p>
          Salvamos dientes da√±ados o infectados, eliminando el dolor y evitando su extracci√≥n.
        </p>
      </a>

      <a class="tr-card" href="/es/tratamientos/odontopediatria" aria-label="Ver tratamientos de Odontopediatr√≠a">
        <img src="/assets/odontopediatria.svg" alt="" />
        <h3>Odontopediatr√≠a</h3>
        <p>
          Cuidamos la sonrisa infantil con tratamientos de prevenci√≥n, control de h√°bitos y ortodoncia temprana.
        </p>
      </a>
    </div>
  </section>

  <!-- =========================
       TR: CTA (Consulta gratuita)
       ========================= -->
  <section class="tr-cta" aria-labelledby="tr-cta-title">
    <div class="tr-cta__inner container">
      <img class="tr-cta__mark" src="/assets/mark-hero.svg" alt="" aria-hidden="true" />
      <h2 id="tr-cta-title" class="tr-cta__title">
        Primera consulta y diagn√≥stico gratuito
      </h2>
      <a class="btn tr-cta__btn" href="/es/cita" aria-label="Agendar tu cita">
        AGENDA TU CITA
      </a>
    </div>
  </section>

  <!-- =========================
       TR: Casos reales (Antes / Despu√©s)
       ========================= -->
  <section class="tr-ba container">
    <h2 class="tr-ba__title">Casos reales de antes y despu√©s</h2>

    <!-- HTML sin cambios (mantiene desktop tal cual) -->
    <div class="ba" data-init-ba>
      <img class="ba__before" src="/assets/casos/caso1-antes.png" alt="Antes" loading="lazy" decoding="async" />
      <img class="ba__after"  src="/assets/casos/caso1-despues.png" alt="Despu√©s" loading="lazy" decoding="async" />
      <input type="range" class="ba__slider" min="0" max="100" value="50" aria-label="Comparador antes/despu√©s" />
      <span class="ba__handle" aria-hidden="true"></span>
    </div>
  </section>

  <Footer locale="es" />
</BaseLayout>

<!-- =========================
     JS comparador (con rAF y eventos pasivos SOLO en m√≥vil)
     ========================= -->
<script>
  // Aplica optimizaciones s√≥lo en m√≥vil para no tocar desktop
  const isMobile = window.matchMedia('(max-width: 640px)').matches;

  document.querySelectorAll('[data-init-ba]').forEach((ba) => {
    const slider = ba.querySelector('.ba__slider');

    // Estado inicial
    const setPct = (p) => ba.style.setProperty('--ba-x', Math.max(0, Math.min(100, p)) + '%');
    setPct(slider.value);

    if (!isMobile) {
      // Desktop: lo de siempre (fluido ya)
      slider.addEventListener('input', (e) => setPct(e.target.value));
      ba.addEventListener('pointerdown', (ev) => {
        const rect = ba.getBoundingClientRect();
        const move = (e) => {
          const x = (e.clientX ?? e.touches?.[0]?.clientX) - rect.left;
          const pct = (x / rect.width) * 100;
          setPct(pct);
          slider.value = Math.round(pct);
        };
        move(ev);
        const up = () => {
          window.removeEventListener('pointermove', move);
          window.removeEventListener('pointerup', up);
        };
        window.addEventListener('pointermove', move);
        window.addEventListener('pointerup', up, { once: true });
      });
      return;
    }

    // üîß CAMBIO (m√≥vil): throttle con rAF + listeners pasivos + pointer capture
    let rafId = null;
    let pctTarget = Number(slider.value) || 50;

    const apply = () => {
      setPct(pctTarget);
      rafId = null;
    };
    const schedule = (pct) => {
      pctTarget = Math.max(0, Math.min(100, pct));
      if (rafId == null) rafId = requestAnimationFrame(apply);
    };

    slider.addEventListener('input', (e) => schedule(e.target.value), { passive: true });

    const moveFromClientX = (clientX) => {
      const rect = ba.getBoundingClientRect();
      const x = Math.max(0, Math.min(rect.width, clientX - rect.left));
      schedule((x / rect.width) * 100);
    };

    ba.addEventListener('pointerdown', (ev) => {
      ba.setPointerCapture(ev.pointerId);
      moveFromClientX(ev.clientX);
      const onMove = (e) => moveFromClientX(e.clientX);
      const onUp = () => {
        ba.releasePointerCapture(ev.pointerId);
        ba.removeEventListener('pointermove', onMove);
        ba.removeEventListener('pointerup', onUp);
      };
      ba.addEventListener('pointermove', onMove, { passive: true });
      ba.addEventListener('pointerup', onUp, { once: true });
    });
  });
</script>
